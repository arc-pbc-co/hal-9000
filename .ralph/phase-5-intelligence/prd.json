{
  "project": "HAL-9000 Refactor",
  "branchName": "ralph/phase-5-intelligence",
  "description": "Phase 5: Enhanced Intelligence - Advanced RLM, semantic clustering, feedback loops",
  "userStories": [
    {
      "id": "P5-001",
      "title": "Add sentence transformers for embeddings",
      "description": "As an RLM processor, I need vector embeddings for semantic analysis.",
      "acceptanceCriteria": [
        "Add sentence-transformers to dependencies",
        "Create src/hal9000/rlm/embeddings.py",
        "Define EmbeddingModel class wrapping SentenceTransformer",
        "Default model: all-MiniLM-L6-v2",
        "Methods: embed(text) -> np.ndarray, embed_batch(texts) -> np.ndarray",
        "Caching of embeddings to avoid recomputation",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-002",
      "title": "Implement semantic clustering for aggregation",
      "description": "As an RLM processor, I need to cluster similar findings.",
      "acceptanceCriteria": [
        "Add scikit-learn and hdbscan to dependencies",
        "Create src/hal9000/rlm/clustering.py",
        "Define SemanticClusterer class",
        "Uses HDBSCAN for clustering embeddings",
        "Methods: cluster(texts) -> dict[cluster_id, list[texts]]",
        "Handles noise points (outliers)",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-003",
      "title": "Create advanced RLM processor",
      "description": "As a document processor, I need semantic aggregation instead of frequency-based.",
      "acceptanceCriteria": [
        "Create src/hal9000/rlm/advanced_processor.py",
        "Define AdvancedRLMProcessor class",
        "aggregate_with_clustering() uses semantic clustering",
        "Generates representative summary for each cluster",
        "Returns confidence scores per finding",
        "Falls back to basic aggregation if clustering fails",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-004",
      "title": "Add vector database support",
      "description": "As a knowledge system, I need persistent vector storage.",
      "acceptanceCriteria": [
        "Add chromadb to dependencies",
        "Create src/hal9000/rlm/vectordb.py",
        "Define VectorStore class wrapping ChromaDB",
        "Methods: add(texts, metadata), search(query, k), delete(ids)",
        "Persistent storage in data/chromadb/",
        "Collection per document type (papers, materials, experiments)",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-005",
      "title": "Implement semantic search skill tool",
      "description": "As a researcher, I want to search by meaning, not just keywords.",
      "acceptanceCriteria": [
        "Add semantic_search tool to KnowledgeGraphSkill",
        "Tool: search(query, k, filters) -> list[results]",
        "Uses VectorStore for similarity search",
        "Returns ranked results with similarity scores",
        "Supports filtering by document type, date, topics",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-006",
      "title": "Create ADAM feedback handler",
      "description": "As ADAM, I need my execution feedback processed for learning.",
      "acceptanceCriteria": [
        "Create src/hal9000/skills/adam/feedback_handler.py",
        "Define FeedbackHandler class",
        "Methods: process_feedback(prompt_id, results, success)",
        "Analyzes failures and suggests corrections",
        "Extracts success factors from successful executions",
        "Updates session context with learnings",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-007",
      "title": "Implement knowledge base update from feedback",
      "description": "As a learning system, I need to store successful experiment parameters.",
      "acceptanceCriteria": [
        "Create src/hal9000/skills/adam/knowledge_updater.py",
        "Define KnowledgeUpdater class",
        "Methods: update_from_success(prompt, results), update_from_failure(prompt, analysis)",
        "Stores successful process parameters in vector DB",
        "Tags with material type, process type, outcome",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-008",
      "title": "Create hypothesis generator",
      "description": "As a researcher, I want AI-generated hypotheses from my research.",
      "acceptanceCriteria": [
        "Create src/hal9000/skills/adam/hypothesis_generator.py",
        "Define HypothesisGenerator class",
        "Methods: generate_hypotheses(session) -> list[Hypothesis]",
        "Uses research context to propose testable hypotheses",
        "Ranks hypotheses by novelty and feasibility",
        "Links hypotheses to supporting literature",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-009",
      "title": "Add hypothesis tool to ADAM skill",
      "description": "As a researcher, I want to generate and manage hypotheses.",
      "acceptanceCriteria": [
        "Add generate_hypotheses tool to ADAMOrchestratorSkill",
        "Add evaluate_hypothesis tool",
        "Add update_hypothesis_status tool",
        "Hypotheses stored in session context",
        "Hypotheses can be converted to ADAM prompts",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-010",
      "title": "Implement experiment suggestion from feedback",
      "description": "As a researcher, I want next experiment suggestions based on results.",
      "acceptanceCriteria": [
        "Add suggest_next_experiment method to FeedbackHandler",
        "Analyzes recent experiment outcomes",
        "Uses vector search to find similar successful experiments",
        "Generates suggestions with rationale",
        "Suggests parameter adjustments for failures",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-011",
      "title": "Add LLM call caching",
      "description": "As a cost-conscious system, I need to cache LLM responses.",
      "acceptanceCriteria": [
        "Create src/hal9000/rlm/cache.py",
        "Define LLMCache class using SQLite",
        "Cache key: hash of (model, messages, temperature)",
        "Methods: get(key), set(key, response), invalidate(key)",
        "TTL-based expiration (configurable)",
        "Cache hit/miss metrics",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-012",
      "title": "Integrate caching with RLM processor",
      "description": "As a processor, I need to use the LLM cache.",
      "acceptanceCriteria": [
        "Update RLMProcessor to check cache before LLM calls",
        "Update AdvancedRLMProcessor similarly",
        "Add --no-cache flag to CLI commands",
        "Add cache stats to status command",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "P5-013",
      "title": "Integration test: full research workflow",
      "description": "As a developer, I need end-to-end tests for the complete workflow.",
      "acceptanceCriteria": [
        "Create tests/integration/test_research_workflow.py",
        "Test: upload papers → process → search → generate hypothesis → create ADAM prompt",
        "Test: receive ADAM feedback → update knowledge → suggest next experiment",
        "Test: semantic search returns relevant results",
        "All tests pass"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    }
  ]
}
